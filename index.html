<!DOCTYPE html>
<html>
  <head>
    <titile>hemnet realtime map</titile>
    <script src="public/js/jquery-2.1.4.min.js"></script>
    <script src="public/js/socket.io-1.3.7.js"></script>
    <script src="public/js/jquery-jvectormap-2.0.3.min.js"></script>
    <script src="public/js/jquery-jvectormap-se-merc.js"></script>
    <link rel="stylesheet" href="public/css/style.css" />
    <link rel="stylesheet" href="public/css/jquery-jvectormap-2.0.3.css" />
    <script>
      $(function() {
        var socket = io("127.0.0.1:4000");

        socket.on('date', function(data){
          console.log('data', data);
        });

        var map,
            markerIndex = 0,
            markersCoords = {};

        map = new jvm.Map({
            map: 'se_merc',
            markerStyle: {
              initial: {
                fill: 'red'
              }
            },
            container: $('#map'),
            onMarkerTipShow: function(e, label, code){
              map.tip.text(markersCoords[code].lat.toFixed(2)+', '+markersCoords[code].lng.toFixed(2));
            },
            onMarkerClick: function(e, code){
              map.removeMarkers([code]);
              map.tip.hide();
            }
        });

        map.container.click(function(e){
            var latLng = map.pointToLatLng(e.offsetX, e.offsetY),
                targetCls = $(e.target).attr('class');

            if (latLng && (!targetCls || (targetCls && $(e.target).attr('class').indexOf('jvectormap-marker') === -1))) {
              markersCoords[markerIndex] = latLng;
              map.addMarker(markerIndex, {latLng: [latLng.lat, latLng.lng]});
              markerIndex += 1;
            }
        });
      });
    </script>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>